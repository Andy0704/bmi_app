<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>健康管理小助手</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            text-align: center;
            color: #333;
        }
        form {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin: 10px 0 5px;
            color: #333;
        }
        input, select {
            width: calc(100% - 16px);
            padding: 8px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            width: 100%;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        .results {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            background-color: #f5f5f5;
        }
        .normal {
            color: green;
        }
        .warning {
            color: orange;
        }
        .danger {
            color: red;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>健康管理小助手</h1>

        <!-- 健康檢查數據分析表單 -->
        <form id="healthForm">
            <h2>健康檢查數據分析</h2>
            <label for="gender">性别</label>
            <select id="gender" name="gender">
                <option value="male">男</option>
                <option value="female">女</option>
            </select>
            <label for="height">身高 (cm)</label>
            <input type="number" step="any" id="height" name="height" required>
            <label for="weight">體重 (kg)</label>
            <input type="number" step="any" id="weight" name="weight" required>
            <label for="hemoglobin">血紅素 (g/dL)</label>
            <input type="number" step="any" placeholder="正常值 男性:13.8-17.2, 女性: 12.1-15.1" id="hemoglobin" name="hemoglobin" required>
            <label for="rbc">紅血球 (million cells/mcL)</label>
            <input type="number" step="any" placeholder="正常值 男性: 4.7-6.1, 女性: 4.2-5.4" id="rbc" name="rbc" required>
            <label for="wbc">白血球 (cells/mcL)</label>
            <input type="number" step="any" placeholder="正常值 4500-11000" id="wbc" name="wbc" required>
            <label for="hct">血球容積比 (%)</label>
            <input type="number" step="any" placeholder="正常值 男性:40-52, 女性: 36-48" id="hct" name="hct" required>
            <label for="platelets">血小板 (cells/mcL)</label>
            <input type="number" step="any" placeholder="正常值 150000-450000" id="platelets" name="platelets" required>
            <label for="mcv">平均紅血球容積 (fL)</label>
            <input type="number" step="any" placeholder="正常值 80-100" id="mcv" name="mcv" required>
            <label for="mch">平均血色素蛋白 (pg)</label>
            <input type="number" step="any" placeholder="正常值 27-31" id="mch" name="mch" required>
            <label for="mchc">平均紅血球血色素濃度 (g/dL)</label>
            <input type="number" step="any" placeholder="正常值 32-36" id="mchc" name="mchc" required>
            <label for="ast">天門冬胺酸轉胺酶 (U/L)</label>
            <input type="number" step="any" placeholder="正常值 10-40" id="ast" name="ast" required>
            <label for="alt">血清丙胺酸轉胺酶 (U/L)</label>
            <input type="number" step="any" placeholder="正常值 7-56" id="alt" name="alt" required>
            <label for="bun">血中尿素氮 (mg/dL)</label>
            <input type="number" step="any" placeholder="正常值 7-20" id="bun" name="bun" required>
            <label for="creatinine">肌酸酐 (mg/dL)</label>
            <input type="number" step="any" placeholder="正常值 男性: 0.6-1.2, 女性: 0.5-1.1" id="creatinine" name="creatinine" required>
            <label for="cholesterol">膽固醇 (mg/dL)</label>
            <input type="number" step="any" placeholder="正常值 125-200" id="cholesterol" name="cholesterol" required>
            <label for="triglycerides">三酸甘油酯 (mg/dL)</label>
            <input type="number" step="any" placeholder="正常值 50-150" id="triglycerides" name="triglycerides" required>
            <label for="glucose">飯前血糖 (mg/dL)</label>
            <input type="number" step="any" placeholder="正常值 70-99" id="glucose" name="glucose" required>
            <label for="neutrophils">嗜中性球 (%)</label>
            <input type="number" step="any" placeholder="正常值 40-60" id="neutrophils" name="neutrophils" required>
            <label for="lymphocytes">淋巴球 (%)</label>
            <input type="number" step="any" placeholder="正常值 20-40" id="lymphocytes" name="lymphocytes" required>
            <label for="monocytes">單核球 (%)</label>
            <input type="number" step="any" placeholder="正常值 2-8" id="monocytes" name="monocytes" required>
            <label for="eosinophils">嗜酸性球 (%)</label>
            <input type="number" step="any" placeholder="正常值 1-4" id="eosinophils" name="eosinophils" required>
            <label for="basophils">嗜鹼性球 (%)</label>
            <input type="number" step="any" placeholder="正常值 0.5-1" id="basophils" name="basophils" required>
            <label>若有項目缺失則填 0</label>
            <button type="submit">提交</button>
        </form>
        <div id="results" class="results"></div>

        <!-- BMI與熱量計算器表單 -->
        <h2>BMI與熱量計算器</h2>
        <form id="calculator-form">
            <div class="input-group">
                <label for="calc-height">身高（公分）:</label>
                <input type="number" id="calc-height" name="height" required>
            </div>
            <div class="input-group">
                <label for="calc-weight">體重（公斤）:</label>
                <input type="number" id="calc-weight" name="weight" required>
            </div>
            <div class="input-group">
                <label for="calc-age">年齡:</label>
                <input type="number" id="calc-age" name="age" required>
            </div>
            <div class="input-group">
                <label for="calc-gender">性別:</label>
                <select id="calc-gender" name="gender" required>
                    <option value="male">男性</option>
                    <option value="female">女性</option>
                </select>
            </div>
            <div class="input-group">
                <label for="activity">每日活動量:</label>
                <select id="activity" name="activity" required>
                    <option value="1.2">身體活動趨於靜態 (little or no exercise)</option>
                    <option value="1.375">身體活動程度較低 (exercise 1-3 days/week)</option>
                    <option value="1.55">身體活動程度適中 (exercise 3-5 days/week)</option>
                    <option value="1.72">身體活動程度較高 (exercise 6-7 days/week)</option>
                    <option value="1.9">身體活動程度激烈 (hard exercise or physical job)</option>
                </select>
            </div>
            <button type="button" onclick="calculateBMI()">開始計算</button>
        </form>
        <div id="bmi-results" class="results">
            <h2>結果:</h2>
            <p id="bmi-result">BMI: </p>
            <p id="ideal-weight-result">理想體重: </p>
            <p id="bmr-result">BMR: </p>
            <p id="tdee-result">TDEE: </p>
        </div>
        <!--活動量建議計算器表單-->
        <h2>活動量建議計算器</h2>
        <form id="exerciseForm">
            <label for="age">年齡（請輸入數字）:</label>
            <input type="number" id="age" name="age" min="5" max="100" required>

            <label for="goal">健康目標:</label>
            <select id="goal" name="goal" required>
                <option value="">請選擇健康目標</option>
                <option value="general">一般維持</option>
                <option value="weight_loss">減重計畫</option>
                <option value="hiit">高強度間歇訓練(HIIT)</option>
                <option value="strength">肌力強化訓練</option>
            </select>

            <label for="activityDays">每週身體活動天數（Ex.走路到公車站、球類運動、慢跑/健走等）:</label>
            <input type="number" id="activityDays" name="activityDays" min="0" max="7" required>

            <label for="strengthDays">每週肌力訓練天數（Ex.重訓、瑜珈、攀岩等）:</label>
            <input type="number" id="strengthDays" name="strengthDays" min="0" max="7" required>
            
            <button type="submit">簡易運動指南</button>
        </form>
        <div class="results" id="resultContainer" style="display:none;">
            <h2>運動建議</h2>
            <p id="exerciseRecommendation"></p>
        </div>
    </div>

    <script>
        document.getElementById('healthForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());

            // 計算BMI
            const height = parseFloat(data.height) / 100;
            const weight = parseFloat(data.weight);
            const bmi = weight / (height * height);
            data.bmi = bmi;

            // 分析结果
            let resultsHTML = '<h2>分析结果</h2>';
            resultsHTML += `<p class="${getClassByBMI(bmi)}">BMI: ${bmi.toFixed(2)}</p>`;

            // 定義檢查值函數
            function checkValue(value, range, name, lowMsg, highMsg, lowAdvice, highAdvice, unit) {
                if (value < range[0]) {
                    resultsHTML += `<p class="danger">${name}: ${value} ${unit} (低) - ${lowMsg}, 建議: ${lowAdvice}</p>`;
                } else if (value > range[1]) {
                    resultsHTML += `<p class="danger">${name}: ${value} ${unit} (高) - ${highMsg}, 建議: ${highAdvice}</p>`;
                } else {
                    resultsHTML += `<p class="normal">${name}: ${value} ${unit} (正常)</p>`;
                }
            }

            const gender = data.gender;
            const hemoglobinRange = gender === 'male' ? [13.8, 17.2] : [12.1, 15.1];
            const rbcRange = gender === 'male' ? [4.7, 6.1] : [4.2, 5.4];
            const hctRange = gender === 'male' ? [40, 52] : [36, 48];
            const creatinineRange = gender === 'male' ? [0.6, 1.2] : [0.5, 1.1];

            // 分析每個字段
            checkValue(parseFloat(data.hemoglobin), hemoglobinRange, '血紅素', '貧血、疲倦、落髮、心悸', '血液循環障礙、頭暈、視力模糊、脾臟腫大', '多吃富含鐵質的食物，如紅肉、菠菜', '避免高鐵食物，保持水分', 'g/dL');
            checkValue(parseFloat(data.rbc), rbcRange, '紅血球', '貧血、疲倦、落髮、心悸', '紅血球增多症', '多吃富含鐵質的食物，如紅肉、菠菜', '避免高鐵食物，保持水分', 'million cells/mcL');
            checkValue(parseFloat(data.wbc), [4500, 11000], '白血球', '骨髓抑制、免疫缺陷、病毒感染', '身體受感染、發炎、白血病、组織壞死', '多吃富含维生素C的食物，如橙子、草莓', '避免高糖食物，保持水分', 'cells/mcL');
            checkValue(parseFloat(data.hct), hctRange, '血球容積比', '貧血', '脱水', '多吃富含鐵質的食物，如紅肉、菠菜', '多喝水，保持水分', '%');
            checkValue(parseFloat(data.platelets), [150000, 450000], '血小板', '再生性貧血、慢性肝炎、肝硬化', '紅血球增多症、慢性骨髓性白血病、骨髓纖维化、慢性感染症', '多吃富含維生素K的食物，如綠葉蔬菜', '避免高脂肪食物，保持水分', 'cells/mcL');
            checkValue(parseFloat(data.mcv), [80, 100], '平均紅血球容積', '缺鐵性貧血、海洋性貧血及慢性疾病', '大細胞性貧血、巨紅血球症', '多吃富含鐵質和維生素B12的食物', '多吃富含葉酸的食物', 'fL');
            checkValue(parseFloat(data.mch), [27, 31], '平均血色素蛋白', '貧血', '大細胞性貧血', '多吃富含鐵質和维生素B12的食物', '多吃富含葉酸的食物', 'pg');
            checkValue(parseFloat(data.mchc), [32, 36], '平均紅血球血色素濃度', '低色素性貧血', '高色素性貧血', '多吃富含鐵質和維生素B12的食物', '多吃富含葉酸的食物', 'g/dL');
            checkValue(parseFloat(data.ast), [10, 40], '天門冬胺酸轉胺酶', '肝功能障礙', '肝損傷', '避免酒精，多吃富含抗氧化劑的食物', '避免酒精，多吃富含抗氧化劑的食物', 'U/L');
            checkValue(parseFloat(data.alt), [7, 56], '血清丙胺酸轉胺酶', '肝功能障礙', '肝損傷', '避免酒精，多吃富含抗氧化劑的食物', '避免酒精，多吃富含抗氧化劑的食物', 'U/L');
            checkValue(parseFloat(data.bun), [7, 20], '血中尿素氮', '肝功能障礙', '腎功能不全', '避免高蛋白飲食，保持水分', '避免高蛋白飲食，保持水分', 'mg/dL');
            checkValue(parseFloat(data.creatinine), creatinineRange, '肌酸酐', '腎功能不全', '腎衰竭', '避免高蛋白飲食，保持水分', '避免高蛋白飲食，保持水分', 'mg/dL');
            checkValue(parseFloat(data.cholesterol), [125, 200], '膽固醇', '身體虛弱、營養吸收不良', '高血壓、心血管病變、心臟病及腦中風', '多吃富含健康脂肪的食物，如鱒鱼、堅果', '避免高脂肪食物，多吃水果和蔬菜', 'mg/dL');
            checkValue(parseFloat(data.triglycerides), [50, 150], '三酸甘油酯', '甲狀腺亢進、吸收不良、自體免疫疾病', '動脈粥状硬化、心臟病', '多吃富含健康脂肪的食物，如鱒鱼、堅果', '避免高脂肪食物，多吃水果和蔬菜', 'mg/dL');
            checkValue(parseFloat(data.glucose), [70, 99], '飯前血糖', '心悸、冒冷汗、頭暈、顫動、脈搏加速', '糖尿病前期、代謝症候群', '多吃含天然糖分的食物，如水果', '避免高糖食物，多吃高纖維食物', 'mg/dL');
            checkValue(parseFloat(data.neutrophils), [40, 60], '嗜中性球', '敗血症,结核,嚴重肺炎,腸傷寒,再生不良性貧血,急性白血病', '扁桃腺發炎,肺炎,骨髓炎,腦炎,膽囊炎,急性胃腸炎,白血病,心肌梗塞', '多吃富含維生素C的食物，如橙子、草莓', '避免高糖食物，多喝水', '%');
            checkValue(parseFloat(data.lymphocytes), [20, 40], '淋巴球', '惡性淋巴腫,結核性淋巴结炎,癌症,白血病', '梅毒,结核,流行性耳下腺炎,百日咳,突眼性甲狀腺腫', '多吃富含維生素C的食物，如橙子、草莓', '避免高糖食物，多喝水', '%');
            checkValue(parseFloat(data.monocytes), [2, 8], '單核球', '敗血病、惡性貧血', '水痘,麻疹,猩紅熱', '多吃富含維生素C的食物，如橙子、草莓', '避免高糖食物，多喝水', '%');
            checkValue(parseFloat(data.eosinophils), [1, 4], '嗜酸性球', '免疫力低下', '寄生蟲病,蕁麻疹,藥物過敏,支氣管氣喘,過敏性皮膚', '多吃富含維生素C的食物，如橙子、草莓', '避免過敏原食物，如海鮮', '%');
            checkValue(parseFloat(data.basophils), [0.5, 1], '嗜鹼性球', '懷孕、甲狀腺功能亢進', '慢性溶血性貧血、真性紅血球增多症、腎臟疾病', '多吃富含維生素C的食物，如橙子、草莓', '避免過敏原食物，如海鮮', '%');

            document.getElementById('results').innerHTML = resultsHTML;

            // 將數據發送到服務器保存
            fetch('/save', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'},
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(responseData => {
                console.log('Success:', responseData);
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        });

        function getClassByBMI(bmi) {
            if (bmi < 18.5) return 'danger';
            if (bmi >= 18.5 && bmi < 24) return 'normal';
            if (bmi >= 24 && bmi < 27) return 'warning';
            if (bmi >= 27 && bmi < 30) return 'danger';
            if (bmi >= 30 && bmi < 35) return 'danger';
            return 'danger';
        }

        function calculateBMI() {
            const height = parseFloat(document.getElementById('calc-height').value) / 100; // 轉換為公尺
            const weight = parseFloat(document.getElementById('calc-weight').value);
            const age = parseInt(document.getElementById('calc-age').value);
            const gender = document.getElementById('calc-gender').value;
            const activityLevel = parseFloat(document.getElementById('activity').value);

            // 計算理想體重範圍
            function calculateIdealWeight(height) {
                const minWeight = 18.5 * height * height;
                const maxWeight = 24.9 * height * height;
                return `${minWeight.toFixed(2)} - ${maxWeight.toFixed(2)} 公斤`;
            }

            // 計算基礎代謝率（BMR）
            function calculateBMR(weight, height, age, gender) {
                let bmr = 0;
                if (gender === 'male') {
                    bmr = 66.47 + (13.75 * weight) + (5.003 * height * 100) - (6.755 * age);
                } else if (gender === 'female') {
                    bmr = 655.1 + (9.563 * weight) + (1.85 * height * 100) - (4.676 * age);
                }
                return bmr;
            }

            // 計算每日總消耗熱量（TDEE）
            function calculateTDEE(weight, height, age, gender, activityLevel) {
                const bmr = calculateBMR(weight, height, age, gender);
                const caloriesNeeded = bmr * activityLevel;
                return caloriesNeeded;
            }

            // 計算BMI並顯示結果
            const bmi = weight / (height * height);
            document.getElementById('bmi-result').textContent = `BMI: ${bmi.toFixed(2)}`;

            // 計算並顯示理想體重範圍
            const idealWeightRange = calculateIdealWeight(height);
            document.getElementById('ideal-weight-result').textContent = `理想體重: ${idealWeightRange}`;

            // 計算並顯示BMR和TDEE
            const bmr = calculateBMR(weight, height, age, gender);
            const tdee = calculateTDEE(weight, height, age, gender, activityLevel);
            document.getElementById('bmr-result').textContent = `BMR: ${bmr.toFixed(2)} 卡`;
            document.getElementById('tdee-result').textContent = `TDEE: ${tdee.toFixed(0)} 卡`;
        }



        // 給運動量建議
        document.addEventListener('DOMContentLoaded', function() {
        var form = document.getElementById('exerciseForm');
    
        form.addEventListener('submit', function(event) {
            event.preventDefault();
        
            var age = parseInt(document.getElementById('age').value);
            var goal = document.getElementById('goal').value;
            var activityDays = parseInt(document.getElementById('activityDays').value);
            var strengthDays = parseInt(document.getElementById('strengthDays').value);
        
            var recommendation = generateExerciseRecommendation({ age, goal, activityDays, strengthDays });
            document.getElementById('exerciseRecommendation').textContent = recommendation;
            document.getElementById('resultContainer').style.display = 'block';
            });
        });

        function generateExerciseRecommendation(data) {
        var { age, goal, activityDays, strengthDays } = data;
        var recommendation = "";

        if (age >= 5 && age <= 17) {
            if (goal === "general") {
                recommendation = getRecommendation(activityDays, strengthDays, "有氧運動", "肌力訓練");
            } else if (goal === "weight_loss") {
                recommendation = getRecommendation(activityDays, strengthDays, "有氧運動", "肌力訓練");
            } else if (goal === "hiit") {
                recommendation = getRecommendation(activityDays, strengthDays, "間歇訓練", "肌力訓練");
            } else if (goal === "strength") {
                recommendation = getRecommendation(activityDays, strengthDays, "有氧運動及肌力訓練", "肌力訓練");
            }
        } else if (age >= 18 && age <= 64) {
            if (goal === "general") {
                recommendation = getRecommendation(activityDays, strengthDays, "中等強度有氧運動", "肌力訓練");
            } else if (goal === "weight_loss") {
                recommendation = getRecommendation(activityDays, strengthDays, "中高強度有氧運動", "肌力訓練");
            } else if (goal === "hiit") {
                recommendation = getRecommendation(activityDays, strengthDays, "高強度間歇訓練", "肌力訓練");
            } else if (goal === "strength") {
                recommendation = getRecommendation(activityDays, strengthDays, "有氧運動及肌力訓練", "肌力訓練");
            }
        } else if (age >= 65) {
            if (goal === "general") {
                recommendation = getRecommendation(activityDays, strengthDays, "輕度活動", "適當的肌力訓練");
            } else if (goal === "weight_loss") {
                recommendation = getRecommendation(activityDays, strengthDays, "中強度有氧運動", "肌力訓練");
            } else if (goal === "hiit") {
                recommendation = getRecommendation(activityDays, strengthDays, "高強度間歇訓練", "肌力訓練");
            } else if (goal === "strength") {
                recommendation = getRecommendation(activityDays, strengthDays, "有氧運動及肌力訓練", "肌力訓練");
            }
        }
        return recommendation;
        }

        function getRecommendation(activityDays, strengthDays, aerobicText, strengthText) {
        var recommendation = "";
    
        if (activityDays >= 0 && activityDays <= 2) {
            recommendation = `逐步增加至每週3天，每次至少20-30分鐘的${aerobicText}。`;
        } else if (activityDays >= 3 && activityDays <= 4) {
            recommendation = `保持每週3-4天的活動，逐步增加每次活動時間至30-45分鐘。`;
        } else if (activityDays >= 5 && activityDays <= 7) {
            recommendation = `保持每週5-7天的活動，每週150-300分鐘的${aerobicText}。`;
        }

        if (strengthDays === 0) {
            recommendation += `逐步增加至每週2天，進行${strengthText}。`;
        } else if (strengthDays === 1) {
            recommendation += `逐步增加至每週2天肌力訓練。`;
        } else if (strengthDays >= 2) {
            recommendation += `保持每週至少2天的${strengthText}。`;
        }

        return recommendation;
        }
    </script>
</body>
</html>


